<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Simpson's paradox and the horrors of unobserved confounders - ssamot's heretical rumblings</title><link rel=icon type=image/png href=/final_logo_purple_inv_sat.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="...it's all a mess and you can show anything"><meta property="og:image" content><meta property="og:title" content="Simpson's paradox and the horrors of unobserved confounders"><meta property="og:description" content="...it's all a mess and you can show anything"><meta property="og:type" content="article"><meta property="og:url" content="https://ssamot.me/posts/simpson/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-23T18:46:56+01:00"><meta property="article:modified_time" content="2022-06-23T18:46:56+01:00"><meta property="og:site_name" content="ssamot's heretical rumblings"><meta name=twitter:card content="summary"><meta name=twitter:title content="Simpson's paradox and the horrors of unobserved confounders"><meta name=twitter:description content="...it's all a mess and you can show anything"><script src=https://ssamot.mejs/feather.min.js></script>
<link href=https://ssamot.me/css/fonts.352cefb34094cd6aeabccf0709d7c4006d075638fcd84db93818af5a51eec660.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://ssamot.me/css/main.74589d0801ac2e0077442cb10044eed50980086bdb7742d01991b816a420536d.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://ssamot.me/css/dark.512da9ec5e8a9c5da6bffed7d277ab45998fc7e791baebc0567864afdf75993d.css><script data-goatcounter=https://ssamot.goatcounter.com/count async src=//gc.zgo.at/count.js></script><noscript><img src="https://ssamot.goatcounter.com/count?p=/posts/simpson"></noscript></head><body><div class=content><header><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><div class=main><a href=https://ssamot.me>ssamot's heretical rumblings</a></div><nav><a href=/about>about</a>
<a href=/contact>contact</a>
<a href=/posts>posts</a>
<a href=/publications>publications</a></nav></header><main><article><div class=title><h1 class=title>Simpson's paradox and the horrors of unobserved confounders</h1><div class=meta>Posted on Jun 23, 2022</div></div><section class=body><p>Let&rsquo;s assume you have collected data from a hospital, where some patients are given a medicine and some are not. No experimental procedure was followed, you just collected whatever was out there and you want to check if taking the medicine causes improvements in health. With a bit of notational abuse, you want to check the effect of $T \rightarrow Y$. $T$ can be either 0 or 1 (whether someone was treated or not using the medicine), while $Y$ is a measurement of life quality &ndash; the higher the better. You plot the means and you see clear differences &ndash; see Figure 1.<figure class=floatleftsplit><img src=/code/simpviolin.png alt="Figure 1. Violin plot for treated and untreated groups"><figcaption><p>Figure 1. Violin plot for treated and untreated groups</p></figcaption></figure>The difference in means is approximately $T_1 - T_0 \approx 1.0$ &ndash; this is termed the Average Treatment Effect ($ATE_X$). You run your t-tests, you get a p-value of $0.00012$ &ndash; good enough by most standards. At this point you are certain that you have gold in your hands, the medicine had a positive result. There are multiple ways you can calculate this effect; since we have no incoming features, we can just subtract the observed averages directly. Another (highly redundant) option would be to fit a regressor, loop over all our patients (i.e. data rows), force T to 1 or T to 0 and calculate averages.</p><p>Now, let&rsquo;s assume that you somehow find a third feature $Z$ &ndash; let&rsquo;s say that in some old scrap of paper someone was recording some other measurement for each patient. You now have two input features, the treatment and your new $Z$. You plug them in to a linear regression model and calculate the average, this time through the model (i.e. you force T=0 and T=1 for each patient and calculate the difference). To your surprise you get $ATE_X = -1$, exactly the opposite of what your initial calculations came up with. This is indeed a freaky event &ndash; knowing and taking into account another feature changed the results radically in the opposite direction &ndash; the medicine is now to be considered harmful!</p><p>Should you take this Z feature into account? Well, there is no way of knowing just by looking at the data, without any insights on how the data was generated. In our case, it was generated as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Z_confounder</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>random(size<span style=color:#f92672>=</span>(observations, <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>T_treatment</span>(Z):
</span></span><span style=display:flex><span>    T <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>rint(Z <span style=color:#f92672>+</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>random(size<span style=color:#f92672>=</span>(observations, <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>    T[T <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    T[T <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> T
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Y_outcome</span>(Z, T):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>T <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> Z
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>z <span style=color:#f92672>=</span> Z_confounder()
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> T_treatment(z)
</span></span><span style=display:flex><span>y <span style=color:#f92672>=</span> Y_outcome(z, t)</span></span></code></pre></div><p>Just by reading the Y_outcome function, we can see that the $ATE_X$ is indeed -1. Y has both Z and T as inputs and T has Z as input. In this case, you <em>should</em> use Z as an input to your model. Judea Perl has a great piece of work here <a href=https://ftp.cs.ucla.edu/pub/stat_ser/r414.pdf>https://ftp.cs.ucla.edu/pub/stat_ser/r414.pdf</a> discussing when you should and you shouldn&rsquo;t use Z in detail (the whole phenomenon is called Simpson&rsquo;s Paradox).</p><p>What if you have no clue what the data generating process is, or worse, you have no idea what other variables you need to measure? Well, you have no way of knowing whether your $ATE_X$ is biased, &ldquo;no unobserved confounders&rdquo; is one of the basic premises of this line of reasoning. You would need to do refutation work &ndash; how badly can you be damaged by unobserved features &mdash; and in our case it looks like this can be quite bit.</p><p>Most importantly, however, the whole premise of using observational data to measure effects allows for debates and interpretations that can go either way. As the saying goes &ldquo;if you torture your data long enough, it will tell you whatever you want to hear&rdquo;.</p><ul><li><a href=/code/simpsons.py>Hacky code for the above post</a></li></ul></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/data-science>Data science</a></li></ul></nav></div></article></main><footer><div class=footer-info><a href=https://twitter.com/spysamot/>Twitter</a>
<a href=https://github.com/ssamot/>GitHub</a>&nbsp|| based on 

    <a href=https://gohugo.io>Hugo</a>/<a href=https://github.com/athul/archie>Archie</a> |
2022 Spyros Samothrakis |</div></footer><script>feather.replace()</script></div></body></html>